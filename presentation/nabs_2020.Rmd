---
title: 'mmir: An R-package for Simple Biological Metric Calculations'
author: "Zachary M. Smith"
date: "March 5th, 2020"
output:
  powerpoint_presentation:
    reference_doc: nysdec_template.pptx
---


## Objective

- Demonstrate the functionality provided by the __mmir__ R-package for calculating biological metrics for the development and/or use in an MMI or IBI.

## What is an MMI?

- Multi-Metric Indices (MMIs) or Indices of Biotic Integrity (IBIs) are models that summarize multiple aspects of a biological community of interest (e.g., richness, diversity, relative abundance, tolerance, and functional feeding group) into a single numeric or categorical value representing ecological condition.
  + considered a robust measure of water quality becuase it represents more than a snapshot in time
  + have been around for nearly 40 years
  
## Need

- MMIs are widely used by U.S. federal and state agencies to assess water quality but there is no R-package available to simplify and standardize metric calculations.

## R Packages: Brief Description

![](images/r_packages.png)

## R Functions: Brief Description

![](images/func_structure.png)

## Tidyverse

![](images/tidyverse_circle.png)

```{r, include=FALSE, message=FALSE}
library(tidyverse)
```

## mmir

Install the Multi-Metric Index (MMI) package, __mmir__, that I am developing from GitHub (https://github.com/zsmith27/mmir).
```{r, eval=FALSE}
devtools::install_github("zsmith27/mmir")
```

Once __mmir__ is installed, load the package with `library()`.
```{r}
library(mmir)
```

## mmir: Required Data Format

- __Requirements__
  + Each row should represent the number of individuals enumerated for a single taxon collected during a single sampling event.
  + There should be columns representing:
    + a unique ID for a sampling event (i.e., key)
    + taxonomic counts
    + various taxonomic ranks (e.g., individual columns for order, family, genus)
    + various taxonomic groups (e.g., tolerance values and functional feeding groups)

## mmir: Required Data Format Example

```{r echo=FALSE}
data("onondaga", package = "mmir")

onondaga %>% 
  select(unique_id,
         reporting_value,
         final_id,
         order,
         family,
         genus) %>% 
  filter(unique_id %in% c("onon_1_1",
                          "caz_1_1")) %>% 
  group_by(unique_id) %>% 
  slice(1:3) %>% 
  knitr::kable()
  
```

## mmir: Getting Started

Load example data included within the package.
```{r}
data("onondaga", package = "mmir")
```

Prepare the data for metric calculation.
```{r}
nest.df <- onondaga %>% 
  group_nest(unique_id, .key = "data") 
```

## mmir: Metric Function Arguements

- `.data` = A data frame where each row should represent the number of individuals enumerated for a single taxon collected during a single sampling event.
- `.key_col` = A single column that represents a unique ID or key (i.e., site ID) that can be used to group the data.
- `.counts_col` = A single numeric column that represents taxonomic counts.
- `.group_col` = A single column that represents a taxomic rank or group of interest.
- `.keep_col` = A column name used in combination with `.keep_vec` to subset the `.data`.
- `.keep_vec` = A vector of values found in `.keep_col` that will be used to subset `.data`.
- `.drop_col` = A column name used in combination with `.drop_vec` to exclude rows from the calculation.
- `.drop_vec` = A vector of values found in `.drop_col` that will be removed from the calculation.

## mmir: Metric Function List

1. Richness: `taxa_rich()`
2. Relative Richness: `taxa_pct_rich()`
3. Abundance: `taxa_abund()`
4. Relative Abundance: `taxa_pct()`
5. Diversity Indices: `taxa_div()`
6. Dominance: `taxa_dom()`
7. Tolerance Indices: `taxa_tol()`


## mmir: Richness Code

```{r}
taxa_rich(.data = nest.df,
          .key_col = unique_id,
          .group_col = family)
```

## mmir: Richness Code Continued

```{r}
nest.df <- nest.df %>%
  mutate(rich_fam = taxa_rich(
    .data = .,
    .key_col = unique_id,
    .group_col = family
  ))
```

## mmir: Richness Results

```{r, echo=FALSE}
nest.df %>% 
  mutate(data = "List of 35 Variables") %>% 
  head() %>% 
  knitr::kable()
```

## mmir: EPT Richness Code

```{r}
nest.df <- nest.df %>%
  mutate(
    rich_ept_genus = taxa_rich(
      .data = .,
      .key_col = unique_id,
      .group_col = family,
      .keep_col = order,
      .keep_vec = c("ephemeroptera",
                    "plectoptera",
                    "trichoptera")
    )
  )
```

## mmir: EPT Richness Results

```{r, echo=FALSE}
nest.df %>% 
  mutate(data = "List of 35 Variables") %>% 
  head() %>% 
  knitr::kable()
```

## mmir: Relative Abundance Code

```{r}
nest.df <- nest.df %>%
  mutate(
    pct_ept = taxa_pct(
      .data = nest.df,
      .key_col = unique_id,
      .counts_col = reporting_value,
      .keep_col = order,
      .keep_vec = c("ephemeroptera",
                    "plecoptera",
                    "trichoptera")
    )
  )
```

## mmir: Relative Abundance Results

```{r, echo=FALSE}
nest.df %>% 
  mutate(data = "List of 35 Variables") %>% 
  head() %>% 
  knitr::kable()
```

## mmir: Diverisity Indices Code

```{r}
nest.df <- nest.df %>%
  mutate(
    div_simpson_genus = taxa_div(
      .data = nest.df,
      .key_col = unique_id,
      .group_col = genus,
      .counts_col = reporting_value,
      .job = "simpson"
    ),
    div_shannon_genus = taxa_div(
      .data = nest.df,
      .key_col = unique_id,
      .group_col = genus,
      .counts_col = reporting_value,
      .job = "shannon",
      .base = 2
    )
  )
```

## mmir: Diverisity Indices Results

```{r, echo=FALSE}
nest.df %>% 
  mutate(data = "List of 35 Variables") %>% 
  head() %>% 
  knitr::kable()
```

## mmir: 

## Acknowledgements

- Interstate Commission on the Potomac River Basin (ICPRB)
  + With a special thank you to Dr. Claire Buchanan
  
- New York State Department of Environmental Conservation (NYSDEC)
  + With a special thank you to Dr. Alexander J. Smith
  
## Contact Information

- __Name:__ Zachary M. Smith
- __Email:__ zachary.smith2@dec.ny.gov
- __GitHub:__ https://github.com/zsmith27
  + __mmir:__ https://github.com/zsmith27/mmir

